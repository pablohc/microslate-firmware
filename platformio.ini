[platformio]
default_envs = xteink_x4

[env:xteink_x4]
platform = espressif32 @ 6.12.0
board = esp32-c3-devkitm-1
framework = arduino

; Use 16MB flash size as per Xteink X4
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216
board_upload.offset_address = 0x10000

; Board configuration
board_build.flash_mode = dio
board_build.flash_size = 16MB
board_build.partitions = partitions.csv

; Build flags optimized for Xteink X4 hardware (matching CrossPoint)
build_unflags =
  -std=gnu++11

build_flags =
  -DARDUINO_USB_MODE=1
  -DARDUINO_USB_CDC_ON_BOOT=1
  -DMINIZ_NO_ZLIB_COMPATIBLE_NAMES=1
  -DEINK_DISPLAY_SINGLE_BUFFER_MODE=1
  -DDISABLE_FS_H_WARNING=1
  -DCORE_DEBUG_LEVEL=0
  -DXTEINK_X4_HARDWARE=1
  -DNIMBLE_ENABLED=1
  -DOMIT_FONTS=1
  -std=gnu++17

; Power management â€” enable ESP-IDF PM API and FreeRTOS tickless idle
; These allow esp_pm_configure() to work and the CPU to sleep between tasks
board_build.sdkconfig_options.CONFIG_PM_ENABLE = y
board_build.sdkconfig_options.CONFIG_FREERTOS_USE_TICKLESS_IDLE = y

; Monitor settings
monitor_port = COM5
monitor_speed = 115200
monitor_filters = 
  esp32_exception_decoder

; Upload settings
upload_protocol = esptool
upload_speed = 115200
upload_port = COM5

; Libraries (local copies in lib/ directory are auto-discovered)
lib_deps =
  h2zero/NimBLE-Arduino@^1.4.2
  
; Check flags for code quality
check_tool = cppcheck
check_flags = --enable=all --suppress=missingIncludeSystem --suppress=unusedFunction --suppress=unmatchedSuppression --suppress=*:*/.pio/* --inline-suppr
check_skip_packages = yes



